# Project language
language: php

php:
  - 7.1

# Required as we are using docker
sudo: required

services:
  - docker

# Cache composer packages so "composer install" is faster
cache:
  directories:
    - $HOME/.composer/cache/files

# Update composer
before-install:
  - composer self-update
  - sudo pip install --user awscli
  - export PATH=$PATH:$HOME/.local/bin
  - docker pull pafortin/goaws
  - docker run -d --name goaws -p 4100:4100 pafortin/goaws

# Install composer dependencies
install:
  - composer install
  - aws --endpoint-url http://localhost:4100 sqs create-queue --queue-name annotations--travis
  - cp ./config/travis.php ./config/local.php

# Run script
script:
  - ./vendor/bin/proofreader src/ web/
  - ./vendor/bin/proofreader --no-phpcpd tests/
  - ./vendor/bin/phpunit
